#!/bin/sh
set -e 

if [ -z $DOTFILES_DIR ]; then
  echo $DOTFILES_DIR
  echo "juuuhuuuuu"
  BASE=$DOTFILES_DIR
else
  BASE="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
fi 


for config_to_link in $BASE/ln_*; do
  mkdir -pv $BASE/backup
  config_name=${config_to_link#*_}
  [ -e ~/.$config_name ] && mv -v ~/.$config_name $BASE/backup/.$config_name
  ln -sfv $config_to_link ~/.$config_name
done

mkdir -p ~/bin
for bin in $BASE/bin/*; do
  ln -svf $bin ~/bin
done

mkdir -p ~/.antigen
curl -L https://cdn.rawgit.com/zsh-users/antigen/v2.1.1/bin/antigen.zsh > ~/.antigen/antigen.zsh

mkdir -p ~/.zshrc.d
cp $BASE/zshrc.d/* ~/.zshrc.d/

# clone
git clone https://github.com/powerline/fonts.git --depth=1
# install
cd fonts
./install.sh
# clean-up a bit
cd ..
rm -rf fonts

# Install Powerline fonts 
#curl -L https://github.com/powerline/powerline/raw/develop/font/PowerlineSymbols.otf > /tmp/PowerlineSymbols.otf
#curl -L https://github.com/powerline/powerline/raw/develop/font/10-powerline-symbols.conf > /tmp/10-powerline-symbols.conf

#mkdir -p ~/.fonts/
#mv /tmp/PowerlineSymbols.otf ~/.fonts/
#fc-cache -vf ~/.fonts/

#mkdir -p ~/.config/fontconfig/conf.d/
#mv /tmp/10-powerline-symbols.conf ~/.config/fontconfig/conf.d/

exec "$@"
